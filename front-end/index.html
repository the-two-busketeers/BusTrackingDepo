<html>
    <head>
        <style>
            body {
                background-color: #FFFFFF;
            }

            #title {
                text-align: center;
            }

            #search-bar {
                position: relative;
                left: 50%;
                transform: translate(-50%, 0%);
            }

            .grid-container {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: 1fr;
                grid-gap: 1em;
                height: 60%;
            }

            .grid-element {
                background-color: gray;
                border: 1px black solid;
                padding: 1px;
                text-align: center;
            }

            .spin {
            	-webkit-animation-name: spin;
                -webkit-animation-duration: 5000ms;
                -webkit-animation-iteration-count: infinite;
                -webkit-animation-timing-function: linear;
            	animation-name: spin;
                animation-duration: 5000ms;
                animation-iteration-count: infinite;
                animation-timing-function: linear;
            }
            @keyframes spin {
            	from {
            		transform: rotate(0deg);
              	}
            	to {
                		transform: rotate(360deg);
            	}
            }

            @-webkit-keyframes spin {
                from { -webkit-transform: rotate(0deg); }
                to { -webkit-transform: rotate(360deg); }
            }

            .accordion {
                background-color: #eee;
                color: #444;
                cursor: pointer;
                padding: 18px;
                width: 100%;
                border: none;
                text-align: left;
                outline: none;
                font-size: 15px;
                transition: 0.4s;
            }

            .active, .accordion:hover {
                background-color: #ccc;
            }

            .accordion:after {
                content: '\002B';
                color: #777;
                font-weight: bold;
                float: right;
                margin-left: 5px;
            }

            .active:after {
                content: "\2212";
            }

            .panel {
                padding: 0 18px;
                background-color: white;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.2s ease-out;
            }
        </style>

    </head>

    <body>

        <div id="title">Reading Buses Depot Tracker</div>

        <input type="text" id="search-bar">

        <div class="grid-container">

            <div class="grid-element" id = "running">
            </div>

            <div class="grid-element" id = "notRunning">
                <div style="padding-top: 15%;" id ="removeDiv">
                    <img class = "spin" src="images/loading.png" width="300" height="300" alt="Logo">
                </div>
            </div>

            <div class="grid-element" id = "oldService">
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

        <script>
        var busJson = {};
        function syncBusData(bool) {
            $.ajax({
                url: "http://192.168.152.140:5000/init",
                type: "GET",
                dataType: "json",
                crossDomain: true,
                success: function (json) {
                        busesJson = json;
                        console.log(json);
                        // Do loop through each section of the json
                        if (bool === true) {
                            // remove loading circle from the running collum
                            // insert the stuff into the sections and then update the variables
                            var image = document.getElementById("removeDiv")

                            image.parentNode.removeChild(image);

                            for (var key in json) {
                                var element = document.getElementById(key)
                                var dict = json[key]
                                for(let i = 0; i < dict.length; i++){
                                    var bus = dict[i]
                                    busJson[bus.vehicle] = bus;
                                    busJson[bus.vehicle].element = CreateBusAccordion(bus, element)
                                }
                            }
                        }
                        else {
                            // do a loop through the stuff and update the data?
                                // appendChild to the correct div that we want
                        }
                    },
                    error: function (res) { console.log(res); }
                }
            )
        }

        function CreateBusAccordion(json, element) {
            var mainDiv = document.createElement("div");
            element.appendChild(mainDiv);
            var acc = document.createElement("button");
            acc.innerHTML = json.vehicle;
            var panel = document.createElement("div");

            panel.innerHTML = "Wow";

            panel.classList.add("panel");
            acc.classList.add("accordion");
            mainDiv.appendChild(acc);
            mainDiv.appendChild(panel);
            acc.addEventListener("click", function() {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.maxHeight){
                    panel.style.maxHeight = null;
                } else {
                    panel.style.maxHeight = panel.scrollHeight + "px";
                }
            });
            return mainDiv;
        }

        setInterval(syncBusData, 1000 * 30);
        syncBusData(true);
    </script>

    </body>
</html>
